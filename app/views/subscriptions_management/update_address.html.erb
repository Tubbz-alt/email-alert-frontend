<% content_for :title, 'Change your email address' %>

<% content_for :back_link do %>
  <%= render "govuk_publishing_components/components/back_link", {
    href: @back_url
  } %>
<% end %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-l">Change your email address</h1>

    <% if flash[:error] %>
      <div class="column-two-thirds">
        <%= render 'govuk_publishing_components/components/error_summary', {
          title: 'We weren’t able to change your email address',
          items: [
            {
              text: 'There’s a problem with your email address',
              href: '#email-address-input',
            }
          ]
        } %>
      </div>
    <% end %>

    <p class="govuk-body">Your current email address is <%= @address %></p>

    <%= form_tag change_address_path, method: :post do %>
      <%= render 'govuk_publishing_components/components/input', {
        error_message: flash[:error],
        id: 'email-address-input',
        label: { text: 'What’s your new email address?' },
        name: :new_address,
        type: 'email',
        value: @new_address,
      } %>
      <% unless @new_address.nil? %>
        <p class="govuk-body">
          If you want to transfer your subscription to <%= @new_address %>,
          you’ll need to subscribe to the same topics again, using the new
          email address. Or you can
          <%= link_to "contact us",
                      "/contact/govuk",
                      class: %w[govuk-link govuk-link--no-visited-state] %>.
        </p>
      <% end %>
      <%= render 'govuk_publishing_components/components/button', {
        text: 'Save',
        margin_bottom: true,
        data_attributes: {
          module: 'auto-track-event',
          track_category: 'email_subscriptions',
          track_action: 'update_address',
        },
      } %>
    <%- end -%>
    <p class="govuk-body">
      <%= link_to "Cancel",
                  @back_url,
                  class: %w[govuk-link govuk-link--no-visited-state] %>
    </p>
  </div>
</div>
